@{
}


<div class="row mt-4">
    <div class="col-sm-6 offset-sm-3">
        <h2>NEW TRANSACTION</h2>
        <form asp-controller="Service" asp-action="" method="post">

            <div class="mt-4">
                <label class="form-label">TYPE</label>
                <select class="form-select" id="cboTypeService" onchange="ShowServices()">
                    <option value="0" selected disabled>Seleccione</option>
                    <option value="income">income</option>
                    <option value="expense">expense</option>
                </select>
            </div>
            <div class="mt-3">
                <label class="form-label  ">SERVICE</label>
                <select class="form-select" id="cboService">
                    <option value="0" selected disabled>Seleccione</option>
                </select>
            </div>
            <div class="mt-3">
                <label class="form-label">DATE</label>
                <input type="date" class="form-control" id="txtDate" autocomplete="off">
            </div>
            <div class="mt-3">
                <label class="form-label">TOTAL AMOUNT</label>
                <input type="number" class="form-control" id="txtAmount" autocomplete="off">
            </div>
            <div class="mt-3">
                <label class="form-label">COMMENT</label>
                <input type="text" class="form-control" id="txtComment" autocomplete="off">
            </div>

            <div class="d-grid gap-2 d-md-block mt-3">
                <button class="btn btn-primary" type="button" onclick="SaveTransaction()">Save</button>
            </div>

        </form>
    </div>
</div>

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .select2-container .select2-selection--single {
            height: 38px;
            padding-top: 4px
        }
    </style>
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
            $(document).ready(function() {
            $('#cboService').select2({
                placeholder: "Seleccione",
                with: '100%'
            });

        });


        async function ShowServices(){

            const typeService = $("#cboTypeService").val();
            const response = await fetch(`/Transaction/ServicesByType?typeService=${typeService}`, {
                method: 'GET',
                headers: {'Content-Type': 'application/json;charset=utf-8'}
            })

            if(response.ok){
                const data = await response.json();

                const serviceSelect = $("#cboService");
                serviceSelect.empty();
                serviceSelect.append( new Option());

                data.forEach((item) => {
                    serviceSelect.append(new Option(item.name, item.serviceId))
                })

                serviceSelect.trigger("change.select2")

            }

          }

        async function SaveTransaction(){

              const modelDto = {
                  data : $('#txtDate').val(),
                  totalAmount : $('#txtAmount').val(),
                  comment : $('#txtComment').val(),
                  serviceId : $('#cboService').val()
              }

              const response = await fetch(`/Transaction/NewTransaction`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json;charset=utf-8'},
                body: JSON.stringify(modelDto)

              })


            if (response.ok) {
                const data = await response.json();

                if (data != 0) {
                    Swal.fire({
                        title: "Registrado correctamente",
                        icon: "success",
                        draggable: true
                    });
                } else {
                    Swal.fire({
                        title: "Error al guardar",
                        icon: "error",
                        draggable: true
                    });
                }
            }
          }




    </script>
}